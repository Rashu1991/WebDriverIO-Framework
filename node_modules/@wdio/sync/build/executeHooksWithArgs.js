"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = executeHooksWithArgs;

var _fibers = _interopRequireDefault(require("./fibers"));

var _logger = _interopRequireDefault(require("@wdio/logger"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const log = (0, _logger.default)('@wdio/sync');

function executeHooksWithArgs(hooks = [], args) {
  if (typeof hooks === 'function') {
    hooks = [hooks];
  }

  if (!Array.isArray(args)) {
    args = [args];
  }

  hooks = hooks.map(hook => new Promise(resolve => {
    let result;

    const execHook = () => {
      delete global.browser._NOT_FIBER;

      try {
        result = hook.apply(null, args);
      } catch (e) {
        log.error(e.stack);
        return resolve(e);
      }

      if (result && typeof result.then === 'function') {
        return result.then(resolve, e => {
          log.error(e.stack);
          resolve(e);
        });
      }

      resolve(result);
    };

    return hook.constructor.name === 'AsyncFunction' ? execHook() : (0, _fibers.default)(execHook).run();
  }));
  return Promise.all(hooks);
}